<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Орієнтовний калькулятор субсидії на оренду житла для ВПО</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      flex-direction: column;
    }
    .calculator {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      max-width: 500px;
      width: 100%;
      padding: 30px;
      margin: 0 auto;
    }
    .logo-container {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo-container img {
      max-height: 60px; /* Adjust as needed */
    }
    .calculator h2 {
      text-align: center;
      color: #333;
      margin-bottom: 5px;
      font-weight: 600;
    }
    .calculator h7 {
      display: block;
      text-align: center;
      font-size: 12px;
      color: #888;
      margin-bottom: 20px;
    }
    .calculator label {
      display: block;
      margin-top: 15px;
      font-weight: 500;
      color: #555;
    }
    .calculator input,
    .calculator select {
      display: block;
      width: 100%;
      box-sizing: border-box;
      padding: 12px 15px;
      margin-top: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    .calculator input:focus,
    .calculator select:focus {
      outline: none;
      border-color: #5563DE;
    }
    .calculator button {
      width: 100%;
      padding: 15px;
      margin-top: 25px;
      background-color: #5563DE;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: background-color 0.3s;
    }
    .calculator button:hover {
      background-color: #4353c9;
    }
    .result {
      margin-top: 25px;
      padding: 20px;
      background: #5563DE;
      border-radius: 8px;
      color: #fff;
      font-size: 16px;
      line-height: 1.6;
    }
    .result .title {
      text-align: center;
      font-weight: 600;
      font-size: 18px;
      margin-bottom: 10px;
    }
    .disclaimer {
      text-align: center;
      font-size: 12px;
      color: #fff;
      margin-top: 10px;
    }
    .tooltip {
      position: relative;
      display: inline-block;
    }
    .info-icon {
      background-color: #5563DE;
      color: #fff;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      text-align: center;
      font-size: 12px;
      line-height: 18px;
      margin-left: 5px;
      cursor: help;
      display: inline-block;
    }
    .tooltip .tooltiptext {
      /* Стилі для десктопу - залишаються як були */
      visibility: hidden;
      width: 250px;
      background-color: #5563DE;
      color: #fff;
      text-align: left;
      border-radius: 8px;
      padding: 15px;
      position: absolute;
      z-index: 1;
      left: -260px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
      line-height: 1.5;
      white-space: normal; /* Виправили тут раніше */
    }
    .tooltip .tooltiptext::after {
       /* Стилі стрілки для десктопу - залишаються як були */
        content: "";
        position: absolute;
        top: 50%;
        left: 100%;
        margin-top: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent transparent transparent #5563DE;
    }
    /* Забираємо hover з CSS для мобільних, бо керує JS */
    /* .tooltip:hover .tooltiptext { ... } */
    /* Якщо потрібен hover на десктопі, його можна залишити тут, ПОЗА @media */
     .tooltip:hover .tooltiptext {
       visibility: visible;
       opacity: 1;
     }

    .tooltiptext ul {
        padding-left: 20px;
        margin-top: 5px;
        margin-bottom: 0;
    }
    .tooltiptext li {
        margin-bottom: 3px;
    }
    .bottom-disclaimer {
      max-width: 500px;
      margin: 20px auto 10px auto;
      font-size: 12px;
      color: #444;
      text-align: center;
      line-height: 1.4;
    }

 /* --- Зміни ТІЛЬКИ всередині цього блоку @media --- */
 @media (max-width: 600px) {
    .calculator {
        padding: 20px;
    }

    .tooltip .tooltiptext {
       visibility: hidden;
       opacity: 0;
       transition: opacity 0.3s; /* Плавність для JS */
       position: absolute;       /* Позиція відносно іконки */
       z-index: 10;
       bottom: 115%;             /* Над іконкою */
       left: 50%;                /* Центруємо відносно іконки */
       transform: translateX(-50%); /* Точне центрування */
       width: 90vw;              /* Ширина на мобільному */
       max-width: 320px;         /* Макс. ширина */
       padding: 15px;
       border-radius: 8px;
       background-color: #5563DE;
       color: #fff;
       font-size: 12px;
       line-height: 1.5;
       text-align: left;
       white-space: normal;
       box-sizing: border-box;
       top: auto;                /* Скидаємо стилі десктопу */
       right: auto;
       margin: 0;
    }

    /* Приховуємо стрілку на мобільних */
    .tooltip .tooltiptext::after {
       display: none;
    }

    /* Клас, який буде додавати JS для показу */
    .tooltip .tooltiptext.visible {
        visibility: visible;
        opacity: 1;
    }

     /* Забираємо десктопний :hover для підказки на мобільних */
     .tooltip:hover .tooltiptext {
       visibility: hidden;
       opacity: 0;
     }
 }
 /* --- Кінець змін всередині @media --- */

  </style>
</head>
<body>

<div class="calculator">
  <div class="logo-container">
    <img src="logo.png" alt="Logo"> <!-- Переконайтесь, що файл logo.png існує -->
  </div>

  <h2>Орієнтовний калькулятор субсидії на оренду житла для ВПО*</h2>
  <h7>*Остаточний розрахунок можна отримати при зверненні до Пенсійного фонду України. Даний орієнтовний калькулятор не гарантує отримання субсидії.</h7>

   <label for="income">
    Середньомісячний дохід домогосподарства (грн):
    <span class="tooltip">
      <span class="info-icon">?</span>
      <span class="tooltiptext">
       Середньомісячний сукупний дохід домогосподарства включає всі види доходів, отриманих його членами, зокрема:
• заробітну плату;
• пенсії;
• стипендії;
• соціальні виплати;
• доходи від підприємницької діяльності;
• інші грошові надходження.
(відповідно до п. 13 ПКМУ 1225)
      </span>
    </span>
  </label>
   <input type="number" id="income" placeholder="Введіть дохід" min="0" oninput="hideResult()" onblur="checkIncome()"> <!-- Змінено min="1" на min="0" для доходу -->

   <label for="familyMembers">
    Кількість членів домогосподарства:
    <span class="tooltip">
      <span class="info-icon">?</span>
      <span class="tooltiptext">
        Домогосподарство — це одна людина чи група осіб, які разом проживають в одному житлі, ведуть спільне господарство та користуються спільним бюджетом.

(визначається відповідно до п.4. ПКМУ 1225)
      </span>
    </span>
  </label>
   <input type="number" id="familyMembers" placeholder="Введіть кількість осіб" min="1" oninput="hideResult()">

   <label for="settlementType">Оберіть тип населеного пункту:</label>
   <select id="settlementType" onchange="updateRegionOptions()">
     <option value="">Оберіть тип</option>
     <option value="city">Обласний центр або місто Київ</option> <!-- Змінено текст для ясності -->
     <option value="smallTown">Інші населені пункти області</option> <!-- Змінено текст для ясності -->
   </select>

   <label for="region">Оберіть область:</label>
   <select id="region" onchange="updateCoefficient()" disabled>
     <option value="">Оберіть область</option>
   </select>

   <label for="regionalCoefficient">
    Коригувальний коефіцієнт:
    <span class="tooltip">
      <span class="info-icon">?</span>
      <span class="tooltiptext">
        Коригувальні коефіцієнти для розрахунку вартості оплати найму (оренди) 1 кв. метра житлового приміщення (будинку, квартири) визначаються Додатком 3 до Порядку реалізації експериментального проекту щодо надання субсидії на оплату вартості або частини вартості найму (оренди) житлового приміщення та компенсації частини податку на доходи фізичних осіб або єдиного податку та військового збору.
      </span>
    </span>
  </label>
   <input type="text" id="regionalCoefficient" readonly placeholder="Автоматично"> <!-- Додано placeholder -->

   <label for="rentedArea">
    Загальна площа орендованого житла (м²):
    <span class="tooltip">
      <span class="info-icon">?</span>
      <span class="tooltiptext">
        Введіть фактичну площу орендованого житла.
      </span>
    </span>
   </label>
   <input type="number" id="rentedArea" placeholder="Введіть площу" min="1" oninput="hideResult()">

   <label for="actualRent">
    Вартість оренди житла (грн):
    <span class="tooltip">
      <span class="info-icon">?</span>
      <span class="tooltiptext">
        Вартість оренди житла зазначається в договорі найму.

Комунальні витрати можуть бути частково або повністю компенсовані коштом субсидії на оплату житлово-комунальних послуг.
      </span>
    </span>
   </label>
   <input type="number" id="actualRent" placeholder="Введіть суму оренди" min="1" oninput="hideResult()">


  <button onclick="calculateSubsidy()">Розрахувати субсидію</button>

  <div class="result" id="result" style="display: none;"></div>
</div>


<div class="bottom-disclaimer">
  <p>Цей орієнтовний калькулятор підготовано за підтримки Агентства ООН у справах біженців в Україні (УВКБ ООН). Зміст орієнтовного калькулятора виключно є відповідальністю Благодійної організації «Благодійний фонд “Стабілізейшен Суппорт Сервісез”» і жодним чином не відображає поглядів УВКБ ООН.</p>
</div>

<script>
  // --- Початок оригінального JS калькулятора ---
  const regionCoefficients = {
    city: {
        'Вінницька': 1.08, 'Волинська': 1.09, 'Дніпропетровська': 1.16, 'Донецька': 0.56,
        'Житомирська': 1.12, 'Закарпатська': 2.40, 'Запорізька': 0.64, 'Івано-Франківська': 1.12,
        'Кіровоградська': 0.91, 'Луганська': 0.56, 'Львівська': 2.24, 'Миколаївська': 0.66,
        'Одеська': 0.89, 'Полтавська': 1.12, 'Рівненська': 1.20, 'Сумська': 0.56,
        'Тернопільська': 0.99, 'Харківська': 0.69, 'Херсонська': 0.56, 'Хмельницька': 1.41,
        'Черкаська': 1.32, 'Чернівецька': 1.35, 'Чернігівська': 0.71, 'м. Київ': 1.22
    },
    smallTown: {
        'Вінницька': 0.97, 'Волинська': 0.98, 'Дніпропетровська': 0.75, 'Донецька': 0.55,
        'Житомирська': 0.51, 'Закарпатська': 2.34, 'Запорізька': 0.53, 'Івано-Франківська': 1.00,
        'Київська': 0.79, 'Кіровоградська': 0.57, 'Луганська': 0.55, 'Львівська': 1.70,
        'Миколаївська': 0.61, 'Одеська': 0.59, 'Полтавська': 0.53, 'Рівненська': 0.69,
        'Сумська': 0.46, 'Тернопільська': 1.03, 'Харківська': 0.66, 'Херсонська': 0.55,
        'Хмельницька': 1.42, 'Черкаська': 0.83, 'Чернівецька': 1.17, 'Чернігівська': 0.44
     }
  };

   function hideResult() {
       document.getElementById('result').style.display = 'none';
   }

   function updateRegionOptions() {
    const settlementType = document.getElementById('settlementType').value;
    const regionSelect = document.getElementById('region');
    regionSelect.innerHTML = '<option value="">Оберіть область</option>';
    document.getElementById('regionalCoefficient').value = ''; // Очищуємо коефіцієнт
    hideResult();

    if (settlementType) {
      regionSelect.disabled = false;
      const regionsData = regionCoefficients[settlementType];
      const regions = Object.keys(regionsData);

      // Коригуємо фільтрацію: показуємо м. Київ лише для типу "city", Київську область - лише для "smallTown"
      const filteredRegions = regions.filter(region => {
          if (settlementType === 'city') {
              return region !== 'Київська';
          } else if (settlementType === 'smallTown') {
              return region !== 'м. Київ';
          }
          return false; // На випадок, якщо тип не city і не smallTown (не має бути)
      });

      // Додаємо відповідний варіант для Києва/області
      if (settlementType === 'city') {
          filteredRegions.push('м. Київ');
      } else if (settlementType === 'smallTown') {
          filteredRegions.push('Київська');
      }


      filteredRegions.sort((a, b) => {
          // Спеціальне сортування, щоб м. Київ було першим
          if (a === 'м. Київ') return -1;
          if (b === 'м. Київ') return 1;
          return a.localeCompare(b, 'uk');
        }
      );

      filteredRegions.forEach(region => {
        const option = document.createElement('option');
        option.value = region;
        option.textContent = region;
        regionSelect.appendChild(option);
      });
    } else {
        regionSelect.disabled = true;
        document.getElementById('regionalCoefficient').value = ''; // Очищуємо коефіцієнт, якщо тип не обрано
    }
  }

  function updateCoefficient() {
    const settlementType = document.getElementById('settlementType').value;
    const region = document.getElementById('region').value;
    const coeffInput = document.getElementById('regionalCoefficient');
    hideResult();

    if (settlementType && region && regionCoefficients[settlementType] && regionCoefficients[settlementType][region]) {
      let coeff = regionCoefficients[settlementType][region];
      coeffInput.value = coeff.toFixed(2);
    } else {
        coeffInput.value = ''; // Очищуємо, якщо область не обрано або дані некоректні
    }
  }

  function checkIncome() {
    const incomeField = document.getElementById('income');
    const value = parseFloat(incomeField.value);
    if (!isNaN(value) && value < 0) {
      alert("Дохід не може бути від'ємним. Будь ласка, введіть коректне значення (0 або більше).");
      incomeField.value = ''; // Очищуємо поле при невірному вводі
    } else if (isNaN(value)) {
        incomeField.value = ''; // Очищуємо, якщо введено не число
    }
     hideResult();
  }


  function calculateSubsidy() {
    const incomeInput = document.getElementById('income');
    const familyMembersInput = document.getElementById('familyMembers');
    const regionalCoefficientInput = document.getElementById('regionalCoefficient');
    const actualRentInput = document.getElementById('actualRent');
    const rentedAreaInput = document.getElementById('rentedArea');
    const resultDiv = document.getElementById('result');
    const settlementTypeSelect = document.getElementById('settlementType');
    const regionSelect = document.getElementById('region');


    resultDiv.innerHTML = '';
    resultDiv.style.display = 'none';

    // Додаткова валідація на заповненість полів
    let errors = [];
    if (incomeInput.value === '' || isNaN(parseFloat(incomeInput.value)) || parseFloat(incomeInput.value) < 0) errors.push("коректний середньомісячний дохід (0 або більше)");
    if (familyMembersInput.value === '' || isNaN(parseInt(familyMembersInput.value)) || parseInt(familyMembersInput.value) <= 0) errors.push("коректну кількість членів домогосподарства (мінімум 1)");
    if (settlementTypeSelect.value === '') errors.push("тип населеного пункту");
    if (regionSelect.value === '') errors.push("область");
    if (regionalCoefficientInput.value === '' || isNaN(parseFloat(regionalCoefficientInput.value)) || parseFloat(regionalCoefficientInput.value) <= 0) errors.push("коригувальний коефіцієнт (оберіть тип пункту та область)");
    if (actualRentInput.value === '' || isNaN(parseFloat(actualRentInput.value)) || parseFloat(actualRentInput.value) <= 0) errors.push("коректну вартість оренди (більше 0)");
    if (rentedAreaInput.value === '' || isNaN(parseFloat(rentedAreaInput.value)) || parseFloat(rentedAreaInput.value) <= 0) errors.push("коректну загальну площу житла (більше 0)");


    if (errors.length > 0) {
      resultDiv.innerHTML = `<p style="color: #ffdddd; font-weight: bold;">Будь ласка, введіть/оберіть: ${errors.join(', ')}.</p>`;
      resultDiv.style.display = 'block';
      resultDiv.style.background = '#d9534f'; // Червоний фон для помилок
      return;
    }

    // Якщо помилок немає, продовжуємо з числовими значеннями
    const income = parseFloat(incomeInput.value);
    const familyMembers = parseInt(familyMembersInput.value);
    const regionalCoefficient = parseFloat(regionalCoefficientInput.value);
    const actualRent = parseFloat(actualRentInput.value);
    const rentedArea = parseFloat(rentedAreaInput.value);


    const costPerSqM = 208;
    const pm = 2920;
    const minSocialArea = 35.22;
    const socialAreaPerMember = 13.65;
    const percentMultiplier = 20;
    const maxPercent = 20;


    let socialNormArea = (familyMembers === 1) ? minSocialArea : (socialAreaPerMember * familyMembers);
    socialNormArea = Math.max(socialNormArea, minSocialArea);


    const effectiveAreaForRentLimit = Math.min(socialNormArea, rentedArea);


    let maxAllowedRent = effectiveAreaForRentLimit * costPerSqM * regionalCoefficient;
    maxAllowedRent = parseFloat(maxAllowedRent.toFixed(2));


    const incomePerMemberForPercent = income / familyMembers;
    let percent_raw = (incomePerMemberForPercent / (2 * pm)) * percentMultiplier;
    let percent_capped = Math.min(percent_raw, maxPercent);
    let B = income * (percent_capped / 100);
    B = parseFloat(B.toFixed(2));


    let subsidyBaseRent = Math.min(actualRent, maxAllowedRent);


    let subsidy_calc = subsidyBaseRent - B;
    let subsidy = Math.max(0, subsidy_calc);
    subsidy = parseFloat(subsidy.toFixed(2));


    let familyPays = actualRent - subsidy;
    familyPays = Math.max(0, familyPays);
    familyPays = Math.min(familyPays, actualRent); // Залишаємо на всяк випадок
    familyPays = parseFloat(familyPays.toFixed(2));


    let resultHtml = '<div class="title">Результати розрахунку*</div>';

    // Виводимо розмір субсидії
    resultHtml += `<p><strong>Орієнтовний розмір субсидії:</strong> <strong style="font-size: 1.1em;">${subsidy.toFixed(2)} грн</strong></p>`;

    resultHtml += `<p><strong>Сума, яку сплачує родина:</strong> ${familyPays.toFixed(2)} грн</p>`;
    resultHtml += `<p><strong>Гранична вартість оренди житла для розрахунку:</strong> ${maxAllowedRent.toFixed(2)} грн</p>`; // Додано для ясності
    resultHtml += '<p class="disclaimer" style="color: #eee; margin-top: 15px;">*Цей розрахунок є орієнтовним і не гарантує отримання субсидії. Остаточний розрахунок здійснює Пенсійний фонд України.</p>'; // Покращений текст

    resultDiv.innerHTML = resultHtml;
    resultDiv.style.background = '#5563DE'; // Повертаємо стандартний фон
    resultDiv.style.display = 'block';
  }
  // --- Кінець оригінального JS калькулятора ---


  // +++ Початок JS для підказок +++
  document.addEventListener('DOMContentLoaded', () => {
    const isMobile = window.matchMedia("(max-width: 600px)").matches;

    if (isMobile) {
      const tooltipContainers = document.querySelectorAll('.tooltip');

      tooltipContainers.forEach(container => {
        const trigger = container.querySelector('.info-icon');
        const tooltipText = container.querySelector('.tooltiptext');

        if (!trigger || !tooltipText) return;

        trigger.addEventListener('click', (event) => {
          event.stopPropagation();

          const isCurrentlyVisible = tooltipText.classList.contains('visible');

          // Спершу ховаємо ВСІ відкриті підказки
          hideAllTooltips();

          // Якщо ця підказка НЕ була видима, показуємо її і коригуємо
          if (!isCurrentlyVisible) {
            tooltipText.classList.add('visible');
            adjustTooltipPosition(tooltipText);
          }
          // Якщо вона була видима, hideAllTooltips() її вже закрила
        });
      });

      // Клік будь-де на сторінці закриває підказки
      document.body.addEventListener('click', () => {
        hideAllTooltips();
      });
    }
    // Для десктопу залишається логіка :hover з CSS
  });

  // Функція ховає всі видимі підказки (лише на мобільних)
  function hideAllTooltips() {
    document.querySelectorAll('.tooltip .tooltiptext.visible').forEach(visibleTooltip => {
      visibleTooltip.classList.remove('visible');
      // Скидаємо transform, щоб наступного разу він взявся з CSS
      visibleTooltip.style.transform = 'translateX(-50%)';
    });
  }

  // Функція коригує позицію підказки, щоб вона не виходила за межі екрану
  function adjustTooltipPosition(tooltipText) {
    requestAnimationFrame(() => {
      const rect = tooltipText.getBoundingClientRect();
      const viewportWidth = window.innerWidth;
      const margin = 10; // Відступ від країв екрану в пікселях

      let translateXCorrectionPx = 0; // Корекція в пікселях

      // Перевірка лівого краю
      if (rect.left < margin) {
        const overflow = margin - rect.left;
        translateXCorrectionPx = overflow; // Треба зсунути вправо
      }
      // Перевірка правого краю
      else if (rect.right > viewportWidth - margin) {
        const overflow = rect.right - (viewportWidth - margin);
        translateXCorrectionPx = -overflow; // Треба зсунути вліво
      }

      // Застосовуємо базовий зсув (-50%) і додаємо корекцію
      tooltipText.style.transform = `translateX(calc(-50% + ${translateXCorrectionPx}px))`;
    });
  }
  // +++ Кінець JS для підказок +++

</script>

</body>
</html>
